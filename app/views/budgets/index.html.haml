- title "My Budgets"
- @body_class = "budget"

- content_for :assets do
  = stylesheet_link_tag "pages/budgets"
  = javascript_include_tag "pages/budgets"
  :javascript
    var receptiveAppSettings = {
      "return_url":"#{budget_url(budget)}",
      "timestamp":"#{Time.now}",
      "account":{
        "id":"#{current_user.subscription.reference}",
        "name":"-",
        "monthly_value":"#{Constants::Subscriptions::PLANS.collect{ |p| p if p[:id] == current_user.subscriptions.last.plan }[0].amount}",
        "is_paying":"#{!current_user.trial?}"},
      "vendor":{
        "id":"vendor-5523bd69-320a-4076-a71d-0158b2293f3e"},
      "user":{
        "id":"#{current_user.id}",
        "email":"current_user.email",
        "full_name":"-"}
      };
    (function() {
      function async_load() {
        var s = document.createElement('script');
        s.type = 'text/javascript'; s.async = true;
        s.src = 'https://receptive.io/js/widget/widget.js';
        var x = document.getElementsByTagName('script')[0];
        x.parentNode.insertBefore(s, x);
      }
      if (window.attachEvent) {
        window.attachEvent('onload', async_load);
      } else {
        window.addEventListener('load', async_load, false);
      }
    })();

.row

  .span9

    %ul.budgets-list
      - @budgets.each do |budget|
        %li.budget
          %a{:href => budget_path(budget)}
            %span.budget-heading
              %strong= budget.name
              Budget
            %span.balance
              %span.balance-label Today
              - balance_today = cents_to_money(budget.balance(Date.today), budget.currency)
              - negative = balance_today.cents < 0
              %span.balance-amount.today{:class => (negative ? 'negative' : 'positive') }
                = balance_today.currency.html_entity.html_safe
                = balance_today.format(:symbol => false, :no_cents_if_whole => true)

  .span3

    %a.button.button-primary.new-budget{:href => new_budget_path}
      Start a
      %strong New Budget
